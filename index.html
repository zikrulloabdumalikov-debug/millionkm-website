<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Million KM | Ro'yxatdan o'tish</title>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --apple-bg: #f5f5f7;
            --apple-blue: #0071e3;
            --radius: 28px;
        }

        body {
            font-family: 'SF Pro Display', sans-serif;
            background-color: var(--apple-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: var(--radius);
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            animation: slideUp 0.8s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 { text-align: center; font-weight: 600; margin-bottom: 30px; }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group { margin-bottom: 15px; }
        .full-width { grid-column: span 2; }

        label { display: block; margin-bottom: 5px; font-size: 13px; color: #86868b; padding-left: 10px; }

        input, select {
            width: 100%;
            padding: 14px;
            border-radius: 14px;
            border: 1px solid #d2d2d7;
            background: #fff;
            font-size: 15px;
            outline: none;
            transition: 0.3s;
        }

        input:focus { border-color: var(--apple-blue); box-shadow: 0 0 0 4px rgba(0,113,227,0.1); }

        .btn-main {
            width: 100%;
            padding: 16px;
            background: var(--apple-blue);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }

        .toggle-link {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: var(--apple-blue);
            cursor: pointer;
        }

        .msg { padding: 10px; border-radius: 10px; text-align: center; display: none; margin-bottom: 15px; font-size: 14px; }
    </style>
</head>
<body>

<div class="auth-card">
    <div id="message" class="msg"></div>
    
    <div id="registerForm">
        <h2>Ro'yxatdan o'tish</h2>
        <div class="form-grid">
            <div class="form-group full-width">
                <label>To'liq ismingiz</label>
                <input type="text" id="regName" placeholder="Ism Sharif">
            </div>
            <div class="form-group">
                <label>Telefon</label>
                <input type="tel" id="regTel" placeholder="+998">
            </div>
            <div class="form-group">
                <label>Jinsi</label>
                <select id="regGender">
                    <option value="Erkak">Erkak</option>
                    <option value="Ayol">Ayol</option>
                </select>
            </div>
            <div class="form-group full-width">
                <label>Email</label>
                <input type="email" id="regEmail" placeholder="example@mail.com">
            </div>
            <div class="form-group">
                <label>Mashina Brand</label>
                <select id="regBrand">
                    <option value="Chevrolet">Chevrolet</option>
                    <option value="KIA">KIA</option>
                    <option value="Li Auto">Li Auto</option>
                </select>
            </div>
            <div class="form-group">
                <label>Mashina Yili</label>
                <input type="number" id="regYear" placeholder="2024">
            </div>
            <div class="form-group full-width">
                <label>Yurgan masofasi (KM)</label>
                <input type="number" id="regKm" placeholder="0">
            </div>
            <div class="form-group full-width">
                <label>Parol yaratish</label>
                <input type="password" id="regPass" placeholder="Kamida 6 belgi">
            </div>
        </div>
        <button class="btn-main" onclick="handleRegister()">Tizimga qo'shilish</button>
        <div class="toggle-link" onclick="location.href='index.html'">Asosiy sahifaga qaytish</div>
    </div>
</div>

<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, createUserWithEmailAndPassword, updateProfile } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, doc, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Sizning Firebase Config (avvalgi koddan olingan)
    const firebaseConfig = {
        apiKey: "AIzaSyA0zyqs1BrDKKS7kkq3nqmJSj_VpM6CVcM",
        authDomain: "millionkm-a42ee.firebaseapp.com",
        projectId: "millionkm-a42ee",
        storageBucket: "millionkm-a42ee.firebasestorage.app",
        messagingSenderId: "594685468082",
        appId: "1:594685468082:web:e44c081e0617f0016998ab"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Telegram Ma'lumotlari
    const BOT_TOKEN = '7722483735:AAG_LZ1Bg0H-mnqAlnw4OknNj-BTrqM8CWM';
    const CHAT_ID = '-1003461463026';

    window.handleRegister = async function() {
        const data = {
            name: document.getElementById('regName').value,
            tel: document.getElementById('regTel').value,
            gender: document.getElementById('regGender').value,
            email: document.getElementById('regEmail').value,
            brand: document.getElementById('regBrand').value,
            year: document.getElementById('regYear').value,
            km: document.getElementById('regKm').value,
            pass: document.getElementById('regPass').value
        };

        if(!data.email || data.pass.length < 6) {
            showMsg("Ma'lumotlar to'liq emas!", "red");
            return;
        }

        try {
            const userCredential = await createUserWithEmailAndPassword(auth, data.email, data.pass);
            const user = userCredential.user;

            await updateProfile(user, { displayName: data.name });

            // Firestorega marketing ma'lumotlarini saqlash
            await setDoc(doc(db, "users", user.uid), {
                ...data,
                uid: user.uid,
                createdAt: new Date().toISOString()
            });

            // Telegramga barcha marketing ma'lumotlarini yuborish
            const tgMsg = `ðŸŒŸ YANGI MIJOZ!\nðŸ‘¤ Ism: ${data.name}\nðŸ“ž Tel: ${data.tel}\nðŸš» Jins: ${data.gender}\nðŸš— Mashina: ${data.brand} (${data.year})\nðŸ›£ Masofa: ${data.km} KM`;
            
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chat_id: CHAT_ID, text: tgMsg })
            });

            showMsg("Muvaffaqiyatli ro'yxatdan o'tdingiz!", "green");
            setTimeout(() => { window.location.href = 'index.html'; }, 2000);

        } catch (e) { showMsg("Xatolik: " + e.message, "red"); }
    };

    function showMsg(t, c) {
        const m = document.getElementById('message');
        m.textContent = t; m.style.display = 'block'; m.style.background = c === 'green' ? '#d4edda' : '#f8d7da';
    }
</script>

</body>
</html>
