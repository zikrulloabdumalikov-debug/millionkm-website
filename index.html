<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Million km - Chevrolet, Kia va Li Auto uchun premium avto servis. Dvigatelni million km gacha saqlang.">
    <meta name="keywords" content="avto servis, Chevrolet, Kia, Li Auto, moy almashtirish, kafolat">
    <title>Million KM | Premium Avto Servis</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
       
        :root {
            --primary: #007aff;
            --bg: #f5f5f7;
            --card: #ffffff;
            --text: #1d1d1f;
            --gray: #6e6e73;
            --green: #34c759;
            --red: #ff3b30;
            --radius: 18px;
            --transition: all 0.3s ease;
        }
       
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }
       
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
       
        .animate { animation: fadeIn 0.6s ease-out forwards; opacity: 0; }
        .animate-delay-1 { animation-delay: 0.2s; }
        .animate-delay-2 { animation-delay: 0.4s; }
        .animate-delay-3 { animation-delay: 0.6s; }
       
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            z-index: 1000;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            transition: var(--transition);
        }
       
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
       
        .logo {
            font-size: 20px;
            font-weight: 600;
            color: var(--text);
        }
       
        .nav-links a {
            margin-left: 30px;
            color: var(--gray);
            text-decoration: none;
            font-size: 14px;
            transition: var(--transition);
        }
       
        .nav-links a:hover { color: var(--primary); transform: translateY(-2px); }
       
        .hero { padding: 140px 20px 100px; text-align: center; max-width: 900px; margin: 0 auto; }
        .hero h1 { font-size: 56px; font-weight: 600; letter-spacing: -0.5px; margin-bottom: 20px; }
        .hero p { font-size: 24px; color: var(--gray); margin-bottom: 40px; }
       
        .btn {
            padding: 12px 30px;
            background: var(--primary);
            color: white;
            border-radius: 980px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }
       
        .btn:hover {
            background: #0071e3;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }
       
        .btn-secondary { background: transparent; color: var(--primary); border: 1px solid var(--primary); }
        .btn-secondary:hover { background: var(--primary); color: white; transform: scale(1.05); }
        .btn-danger { background: var(--red); color: white; }
        .btn-danger:hover { background: #ff2d20; }
       
        .brands-section, .benefits, .map-section, #cabinet, #adminPanel { padding: 80px 20px; max-width: 1200px; margin: 0 auto; }
        .section-title { font-size: 44px; font-weight: 600; text-align: center; margin-bottom: 60px; }
       
        .brands-grid, .cabinet-grid, .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
       
        .brand-card, .cabinet-card, .admin-card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 30px;
            text-align: center;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            transition: var(--transition);
        }
       
        .brand-card:hover, .cabinet-card:hover, .admin-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }
       
        .modal, #serviceModal, #editCarModal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
       
        .modal-content, .service-box, .edit-car-box {
            background: white;
            max-width: 900px;
            width: 90%;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }
       
        .close-modal {
            float: right;
            font-size: 30px;
            cursor: pointer;
            color: var(--gray);
        }
       
        .close-modal:hover { color: var(--text); transform: rotate(90deg); }
       
        .chat-widget { position: fixed; bottom: 20px; right: 20px; z-index: 1500; }
        .chat-button {
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.2);
        }
       
        .chat-box {
            display: none;
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            flex-direction: column;
        }
       
        .chat-header { background: var(--primary); color: white; padding: 20px; border-radius: 20px 20px 0 0; }
        .chat-messages { flex: 1; padding: 20px; overflow-y: auto; }
        .chat-input { padding: 15px; border-top: 1px solid rgba(0,0,0,0.1); }
       
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 30px;
            border-radius: 10px;
            color: white;
            z-index: 4000;
            opacity: 0;
            transition: opacity 0.4s ease;
        }
       
        .toast.show { opacity: 1; }
        .toast.success { background: var(--green); }
        .toast.error { background: var(--red); }
       
        footer { background: white; padding: 80px 20px; text-align: center; border-top: 1px solid rgba(0,0,0,0.1); }
       
        @media (max-width: 768px) {
            .hero h1 { font-size: 40px; }
            .nav-links { display: none; }
            .brands-grid, .cabinet-grid, .admin-grid { grid-template-columns: 1fr; }
            .chat-box { width: 100%; right: 0; bottom: 0; height: 100vh; border-radius: 0; }
        }
    </style>
</head>
<body>

<nav class="animate">
    <div class="nav-container">
        <div class="logo">Million km</div>
        <div class="nav-links">
            <a href="#brands">Brendlar</a>
            <a href="#services">Xizmatlar</a>
            <a href="#benefits">Afzalliklar</a>
            <a href="#filiallar">Filiallar</a>
            <a href="#" id="authLink">Kirish</a>
            <a href="#" id="cabinetLink" class="hidden">Kabinet</a>
            <a href="#" id="adminLink" class="hidden">Admin</a>
        </div>
    </div>
</nav>

<!-- Hero, Brands, Services, Benefits, Status Checker, Map bo'limlari o'zgarmagan holda qoldirildi -->

<!-- Cabinet Section -->
<section id="cabinet" class="hidden">
    <h2 class="section-title animate">Mening Kabinetim</h2>
    <p id="welcomeText" class="animate animate-delay-1" style="text-align:center; color:var(--gray); margin-bottom:40px;"></p>
    
    <div class="add-car-form animate animate-delay-2">
        <h3>Mashina qo‘shish</h3>
        <input id="addCarModel" placeholder="Mashina modeli">
        <input id="addCarYear" type="number" min="1900" placeholder="Yili">
        <input id="addLastOilKm" type="number" min="0" placeholder="Oxirgi moy (km)">
        <input id="addDailyKm" type="number" min="1" placeholder="Kunlik yurish (km)">
        <button class="btn" id="addCarSubmit" style="width:100%;margin-top:15px;">Qo‘shish</button>
    </div>
    
    <div id="garage" class="cabinet-grid"></div>
</section>

<!-- Admin Panel -->
<section id="adminPanel" class="hidden">
    <h2 class="section-title animate">Admin Panel</h2>
    <div id="allUsers"></div>
    <div id="allCars"></div>
    <div id="allServices"></div>
</section>

<!-- Modals (auth, service, editCar) o'zgarmagan -->

<script>
// Global funksiyalarni window ga bog'laymiz
window.openAuth = openAuth;
window.checkStatus = checkStatus;
window.openCabinet = openCabinet;
window.openAdminPanel = openAdminPanel;
window.openServiceModal = openServiceModal;
window.closeModal = closeModal;
window.closeAuth = closeAuth;
window.closeServiceModal = closeServiceModal;
window.deleteCar = deleteCar;
window.toggleChat = toggleChat;
window.sendMessage = sendMessage;
window.scrollToSection = scrollToSection;

// Firebase imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, query, where, onSnapshot, deleteDoc, doc, getDocs, updateDoc, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyA0zyqs1BrDKKS7kkq3nqmJSj_VpM6CVcM",
    authDomain: "millionkm-a42ee.firebaseapp.com",
    projectId: "millionkm-a42ee",
    storageBucket: "millionkm-a42ee.firebasestorage.app",
    messagingSenderId: "594685468082",
    appId: "1:594685468082:web:e44c081e0617f0016998ab"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const TG_TOKEN = "7722483735:AAG_LZ1Bg0H-mnqAlnw4OknNj-BTrqM8CWM";
const TG_CHAT_ID = "-1003461463026";

// Telegram xabar yuborish
async function sendTelegramMessage(text) {
    try {
        await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                chat_id: TG_CHAT_ID,
                text,
                parse_mode: "Markdown"
            })
        });
    } catch (e) {
        console.error("Telegram xato:", e);
    }
}

// Toast
function showToast(msg, type = 'success') {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = `toast show ${type}`;
    setTimeout(() => t.className = 'toast', 4000);
}

// Validatsiya yordamchilari
function isValidEmail(email) { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); }
function isValidPhone(phone) { return /^\+?\d{9,13}$/.test(phone.replace(/\s/g,'')); }

// Auth modal ochish
function openAuth(isLogin = false) {
    const m = document.getElementById('authModal');
    document.getElementById('authTitle').textContent = isLogin ? 'Kirish' : 'Ro\'yxatdan o\'tish';
    document.getElementById('authSubmitBtn').textContent = isLogin ? 'Kirish' : 'Ro\'yxatdan o\'tish';
    document.getElementById('userPassword').required = true;
    document.getElementById('userGender').style.display = isLogin ? 'none' : 'block';
    document.getElementById('authSubmitBtn').onclick = isLogin ? loginUser : registerUser;
    m.style.display = 'flex';
    setTimeout(() => m.classList.add('show'), 10);
}

// Barcha onclick funksiyalari window orqali global qilinadi
window.openAuth = openAuth;
window.closeAuth = function() {
    const m = document.getElementById('authModal');
    m.classList.remove('show');
    setTimeout(() => m.style.display = 'none', 300);
};

// Register
async function registerUser() {
    const name = document.getElementById('userName').value.trim();
    const email = document.getElementById('userEmail').value.trim();
    const pass = document.getElementById('userPassword').value;
    const phone = document.getElementById('userPhone').value.trim();
    const gender = document.getElementById('userGender').value;

    if (!name || !isValidEmail(email) || pass.length < 6 || !isValidPhone(phone) || !gender) {
        showToast("Ma'lumotlar noto'g'ri yoki to'liq emas!", 'error');
        return;
    }

    try {
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        await addDoc(collection(db, "users"), {
            uid: cred.user.uid,
            name, email, phone, gender,
            createdAt: new Date()
        });
        showToast("Ro'yxatdan o'tdingiz!", 'success');
        closeAuth();
    } catch (e) {
        showToast(e.message.includes('email-already-in-use') ? "Bu email allaqachon ro'yxatdan o'tgan" : e.message, 'error');
    }
}

// Login
async function loginUser() {
    const email = document.getElementById('userEmail').value.trim();
    const pass = document.getElementById('userPassword').value;

    if (!isValidEmail(email) || !pass) {
        showToast("Email yoki parol noto'g'ri!", 'error');
        return;
    }

    try {
        await signInWithEmailAndPassword(auth, email, pass);
        showToast("Kirish muvaffaqiyatli!", 'success');
        closeAuth();
    } catch (e) {
        showToast("Email yoki parol xato!", 'error');
    }
}

// Auth holatini kuzatish
onAuthStateChanged(auth, user => {
    if (user) {
        document.getElementById('authLink').textContent = 'Chiqish';
        document.getElementById('authLink').onclick = () => signOut(auth).then(() => location.reload());
        document.getElementById('cabinetLink').classList.remove('hidden');
        document.getElementById('adminLink').classList.toggle('hidden', user.email !== 'admin@example.com'); // misol admin email
        loadUserData(user.uid);
    } else {
        document.getElementById('authLink').textContent = 'Kirish';
        document.getElementById('authLink').onclick = () => openAuth(true);
        document.getElementById('cabinetLink').classList.add('hidden');
        document.getElementById('adminLink').classList.add('hidden');
    }
});

// Foydalanuvchi ma'lumotlarini yuklash
async function loadUserData(uid) {
    const q = query(collection(db, "users"), where("uid", "==", uid));
    const snap = await getDocs(q);
    if (!snap.empty) {
        const data = snap.docs[0].data();
        document.getElementById('welcomeText').textContent = `Xush kelibsiz, ${data.name}!`;
    }
}

// Qolgan funksiyalar (checkStatus, openCabinet, addCar, etc.) ham window. bilan bog'lanadi

// Misol uchun add car tugmasi
document.getElementById('addCarSubmit').onclick = async function() {
    // ... oldingi logika
    showToast("Mashina qo'shildi!", 'success');
};

    </script>
</body>
</html>
